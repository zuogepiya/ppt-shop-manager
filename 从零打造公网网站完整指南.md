# 从零打造公网网站完整指南

## 🎯 目标

将本地开发的 PPT 制作店铺员工管理系统，部署到公网，让员工可以远程访问。

**公网地址：** https://ppt-shop-manager.vercel.app

---

## 📋 前置准备

### 需要的账号
- [x] Supabase 账户（免费，用于数据库）
- [x] Vercel 账户（免费，用于部署）
- [x] GitHub 账户（用于代码托管）

### 项目信息
- **项目名称：** ppt-shop-manager
- **Supabase 项目标识：** rffppmzvtysyojrznbgo
- **数据库密码：** Yaq199712@

---

## 第一步：准备代码并推送到 GitHub

### 1.1 初始化 Git 仓库（如果还没有）

在项目目录打开终端，执行以下命令：

```bash
# 初始化 Git 仓库
git init

# 添加所有文件
git add .

# 创建第一次提交
git commit -m "feat: 初始化项目 - PPT制作店铺员工管理系统"

# 查看状态
git status
```

### 1.2 创建 GitHub 仓库

1. **登录 GitHub**
   - 访问 https://github.com
   - 登录你的账号

2. **创建新仓库**
   - 点击右上角的 "+" 图标
   - 选择 "New repository"
   - 填写以下信息：
     - Repository name: `ppt-shop-manager`
     - Description: `PPT制作店铺员工管理系统 - 支持四种角色权限管理`
     - Public/Private: 选择 **Private**（推荐私有）
     - 不要勾选 "Add a README file"
     - 不要勾选 "Add .gitignore"
   - 点击 "Create repository"

3. **连接本地仓库到 GitHub**

   GitHub 会显示连接命令，选择 **"push an existing repository from the command line"** 部分，复制命令执行：

   ```bash
   git remote add origin https://github.com/你的用户名/ppt-shop-manager.git
   git branch -M main
   git push -u origin main
   ```

   **注意：** 将 `你的用户名` 替换为你的实际 GitHub 用户名

### 1.3 验证代码已推送

1. 访问 GitHub 仓库页面
   - 地址：https://github.com/你的用户名/ppt-shop-manager

2. **确认以下内容：**
   - ✅ 可以看到项目文件
   - ✅ package.json 存在
   - ✅ src/ 目录存在
   - ✅ vercel.json 存在

---

## 第二步：配置 Supabase 数据库

### 2.1 登录 Supabase

1. 访问 https://supabase.com/dashboard
2. 登录你的 Supabase 账号
3. 确认项目状态为 **Active**

### 2.2 获取 Session Pooler 连接字符串

1. **选择你的项目**
   - 在项目列表中，点击你的项目

2. **进入数据库设置**
   - 在左侧菜单，点击 **"Settings"**
   - 点击 **"Database"**

3. **获取连接字符串**
   - 向下滚动到 **Connection String** 部分
   - 在 **Type** 下拉菜单中，选择 **"Connection pooling"**
   - 在 **Mode** 下拉菜单中，选择 **"Session"**
   - **复制连接字符串**

   **你看到的连接字符串格式：**
   ```
   postgresql://postgres.rffppmzvtysyojrznbgo:[YOUR-PASSWORD]@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres
   ```

### 2.3 替换密码并编码

**关键步骤：**

你的密码是 `Yaq199712@`，包含 `@` 符号，在 URL 中需要编码为 `%40`

**完整的 DATABASE_URL（请复制保存）：**
```
postgresql://postgres.rffppmzvtysyojrznbgo:Yaq199712%40@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres
```

**连接字符串详解：**
```
postgresql://                          # 协议
postgres.rffppmzvtysyojrznbgo:        # 用户名（包含项目标识）
Yaq199712%40                           # 密码（@ 编码为 %40）
@aws-0-ap-southeast-1.pooler.supabase.com:6543  # 主机和端口（Session Pooler）
/postgres                              # 数据库名
```

**请保存这个连接字符串，下一步要用到！**

---

## 第三步：在 Vercel 创建新项目

### 3.1 登录 Vercel

1. 访问 https://vercel.com/dashboard
2. 点击 **"Continue with GitHub"**（推荐使用 GitHub 登录）
3. 授权 Vercel 访问你的 GitHub 仓库

### 3.2 导入 GitHub 仓库

1. **创建新项目**
   - 在 Vercel Dashboard，点击 **"Add New..."**
   - 选择 **"Project"**

2. **选择 GitHub 仓库**
   - 在 "Import Git Repository" 部分
   - 找到并选择你的仓库 `ppt-shop-manager`
   - 点击 **"Import"**

3. **配置项目信息**
   - Project Name: `ppt-shop-manager`（默认即可）
   - Framework Preset: `Next.js`（自动检测）
   - Root Directory: `./`（默认即可）
   - 点击 **"Continue"**

4. **确认构建配置**

   Vercel 会自动检测并显示构建配置：

   | 配置项 | 值 | 说明 |
   |--------|-----|------|
   | Framework | Next.js | 自动检测 |
   | Build Command | `next build` | 自动检测 |
   | Output Directory | `.next` | 自动检测 |
   | Install Command | `pnpm install` | 自动检测 |

   **重要：**
   - ✅ 确认 Output Directory 是 `.next`（不是 `public`）
   - ✅ 确认使用 pnpm 作为包管理器
   - 不要修改这些配置

5. **暂时不配置环境变量**
   - 点击 **"Deploy"** 按钮
   - 这次部署会失败（因为没有配置环境变量），但没关系
   - 我们需要先创建项目，然后再配置环境变量

---

## 第四步：配置 Vercel 环境变量

### 4.1 进入环境变量配置页面

1. **在 Vercel Dashboard 中**
   - 点击你的项目 `ppt-shop-manager`
   - 点击顶部的 **"Settings"** 标签

2. **进入环境变量页面**
   - 点击左侧菜单的 **"Environment Variables"**

### 4.2 添加环境变量

#### 环境变量 1：DATABASE_URL

1. 点击 **"Add New"** 按钮
2. 填写以下内容：

```
Key: DATABASE_URL
Value: postgresql://postgres.rffppmzvtysyojrznbgo:Yaq199712%40@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres
Note: Supabase Session Pooler 连接字符串
Environments: ✅ Production
              ✅ Preview
              ✅ Development
```

3. 点击 **"Add"** 或 **"Save"**

**重要提示：**
- Value 部分完整复制粘贴第二步保存的连接字符串
- 不要有额外空格
- 确保 `@` 已编码为 `%40`

#### 环境变量 2：SESSION_SECRET

1. 点击 **"Add New"** 按钮
2. 填写以下内容：

```
Key: SESSION_SECRET
Value: ppt-shop-session-2025-secret-key-abc123xyz-secure-random-string
Note: 用于 Session 加密的密钥
Environments: ✅ Production
              ✅ Preview
              ✅ Development
```

3. 点击 **"Add"** 或 **"Save"**

**说明：**
- SESSION_SECRET 可以是任意字符串
- 建议使用复杂的随机字符串
- 用于加密用户登录 Session

#### 环境变量 3：NODE_ENV

1. 点击 **"Add New"** 按钮
2. 填写以下内容：

```
Key: NODE_ENV
Value: production
Note: 环境标识
Environments: ✅ Production
              ✅ Preview
              ✅ Development
```

3. 点击 **"Add"** 或 **"Save"**

### 4.3 验证环境变量配置

在环境变量页面，你应该看到以下三个变量：

| Key | Value | Environments |
|-----|-------|--------------|
| DATABASE_URL | `postgresql://postgres.rffppmzvtysyojrznbgo:Yaq199712%40@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres` | ✅ Production, Preview, Development |
| SESSION_SECRET | `ppt-shop-session-2025-secret-key-abc123xyz-secure-random-string` | ✅ Production, Preview, Development |
| NODE_ENV | `production` | ✅ Production, Preview, Development |

**检查清单：**
- [ ] DATABASE_URL 使用 Session Pooler 连接
- [ ] DATABASE_URL 密码中的 @ 已编码为 %40
- [ ] SESSION_SECRET 已添加
- [ ] NODE_ENV 已设置为 production
- [ ] 所有环境变量都勾选了 Production, Preview, Development
- [ ] 所有变量都已保存

---

## 第五步：重新部署到公网

### 5.1 触发重新部署

1. **回到部署页面**
   - 点击顶部的 **"Deployments"** 标签
   - 找到之前的部署记录（可能显示 Error）

2. **重新部署**
   - 点击部署记录右侧的 **"···"**（三个点）菜单
   - 选择 **"Redeploy"**
   - 在弹出的对话框中，确认信息
   - 点击 **"Redeploy"** 按钮

### 5.2 等待部署完成

部署需要 2-3 分钟，你会看到以下状态变化：

1. **Queued** - 排队中
2. **Building** - 构建中（约 1-2 分钟）
3. **Deploying** - 部署中（约 30 秒）
4. **Ready** - 部署成功 ✅

**监控部署：**
- 在部署页面，点击部署记录可以查看实时日志
- 确认没有错误信息
- 构建成功后，状态会显示为 **Ready**

### 5.3 获取公网地址

部署成功后，Vercel 会分配一个公网地址：

**默认地址：** https://ppt-shop-manager.vercel.app

你也可以看到：
- **Domains** 标签：显示绑定的域名
- **URL**: 你的公网访问地址

---

## 第六步：验证部署成功

### 6.1 检查部署状态

在 Vercel Deployments 页面，确认：

- ✅ 最新部署的状态显示 **Ready**（绿色）
- ✅ 没有错误信息
- ✅ 构建时间显示正常（约 1-2 分钟）

### 6.2 测试公网访问

#### 测试 1：访问主页

在浏览器中打开：

**网址：** https://ppt-shop-manager.vercel.app

**预期结果：**
- ✅ 页面正常加载
- ✅ 显示登录界面
- ✅ 界面样式正常（使用 Tailwind CSS）

**如果失败：**
- 检查 Vercel 部署日志
- 查看浏览器控制台错误（按 F12）

#### 测试 2：初始化数据库

在浏览器中打开：

**网址：** https://ppt-shop-manager.vercel.app/api/init-db

**预期结果：**
```json
{
  "success": true,
  "message": "数据库初始化成功"
}
```

**或者：**
```json
{
  "success": true,
  "message": "数据库表已存在"
}
```

这也表示成功 ✅（说明数据库已初始化）

**如果失败：**
- 检查 DATABASE_URL 配置
- 确认 Supabase 数据库状态为 Active
- 查看浏览器控制台错误

#### 测试 3：登录系统

**网址：** https://ppt-shop-manager.vercel.app

**使用默认管理员账号登录：**
- 用户名：`admin`
- 密码：`admin123`

**预期结果：**
- ✅ 登录成功
- ✅ 跳转到总台管理页面
- ✅ 显示四个角色端口入口

**如果登录失败：**
- 检查 SESSION_SECRET 是否已配置
- 确认数据库已初始化
- 查看浏览器控制台错误

---

## 第七步：测试各角色端口

### 7.1 总台管理端口

**网址：** https://ppt-shop-manager.vercel.app/dashboard/admin

**功能测试：**
- ✅ 显示员工管理、订单管理、财务管理入口
- ✅ 员工管理功能正常
- ✅ 订单管理功能正常
- ✅ 财务管理功能正常

### 7.2 管理者端口

**网址：** https://ppt-shop-manager.vercel.app/dashboard/manager

**功能测试：**
- ✅ 显示员工列表
- ✅ 显示订单统计
- ✅ 可以查看详细信息

### 7.3 客服端口

**网址：** https://ppt-shop-manager.vercel.app/dashboard/cs

**功能测试：**
- ✅ 客户管理功能
- ✅ 订单查询功能
- ✅ 可以添加和查询客户

### 7.4 设计师端口

**网址：** https://ppt-shop-manager.vercel.app/dashboard/designer

**功能测试：**
- ✅ 显示分配的任务列表
- ✅ 可以更新任务状态
- ✅ 可以查看任务详情

---

## 第八步：配置和管理

### 8.1 修改默认管理员密码

**操作步骤：**

1. **以 admin 身份登录**
   - 访问 https://ppt-shop-manager.vercel.app
   - 使用 admin/admin123 登录

2. **进入员工管理**
   - 在总台管理页面，点击"员工管理"
   - 找到 admin 账号

3. **修改密码**
   - 点击编辑按钮
   - 修改密码为强密码
   - 保存

**注意：** 修改后记得保存新密码！

### 8.2 添加员工账号

**操作步骤：**

1. **以 admin 身份登录**

2. **进入员工管理**
   - 点击"员工管理"

3. **添加新员工**
   - 点击"添加员工"按钮
   - 填写员工信息：
     - 用户名（登录账号）
     - 姓名
     - 密码
     - 角色（总台管理、管理者、客服、设计师）
     - 手机号
     - 邮箱
   - 保存

4. **通知员工**
   - 将登录地址和账号信息发送给员工
   - 员工使用分配的账号登录即可

### 8.3 分享公网地址

部署成功后，你的员工可以通过以下地址访问：

**主网址：** https://ppt-shop-manager.vercel.app

**员工登录流程：**
1. 打开网址
2. 输入分配的用户名和密码
3. 系统根据角色自动跳转到对应的管理页面
4. 开始工作

### 8.4 自定义域名（可选）

如果你有自己的域名，可以绑定到 Vercel：

1. **在 Vercel 中**
   - 进入项目设置
   - 点击 **"Domains"** 标签
   - 输入你的域名（如：ppt.yourdomain.com）
   - 按照提示配置 DNS

2. **配置 DNS**
   - 登录你的域名管理后台
   - 添加 CNAME 记录指向 Vercel
   - 等待 DNS 生效（通常 10-30 分钟）

---

## 常见问题排查

### 问题 1：部署显示 Error

**原因：** 构建失败

**解决方法：**
1. 查看部署日志（Deployments → 点击部署记录）
2. 检查错误信息
3. 常见错误：
   - 依赖安装失败 → 检查 package.json
   - TypeScript 错误 → 检查代码语法
   - 环境变量未定义 → 确认环境变量已配置

### 问题 2：部署 Ready 但访问 500 错误

**原因：** 运行时错误，通常是环境变量或数据库连接问题

**解决方法：**
1. 检查 DATABASE_URL 格式是否正确
   - 确认使用 Session Pooler
   - 确认密码中的 @ 已编码为 %40
   - 确认端口是 6543
2. 检查 SESSION_SECRET 是否已配置
3. 检查 Supabase 数据库状态为 Active
4. 查看 Function Logs（部署页面 → View Logs）

### 问题 3：数据库连接失败

**原因：** 数据库连接字符串错误或数据库不可用

**解决方法：**
1. 确认使用 Connection Pooling → Session 模式
2. 确认主机地址是 `aws-0-ap-southeast-1.pooler.supabase.com`
3. 确认端口是 `6543`
4. 确认用户名是 `postgres.rffppmzvtysyojrznbgo`
5. 确认密码正确
6. 检查 Supabase 项目状态

### 问题 4：登录失败

**原因：** 数据库未初始化或 SESSION_SECRET 未配置

**解决方法：**
1. 访问 /api/init-db 初始化数据库
2. 检查 SESSION_SECRET 是否已配置
3. 确认默认账号密码是 admin/admin123
4. 查看浏览器控制台错误

### 问题 5：页面样式混乱

**原因：** CSS 加载失败

**解决方法：**
1. 清除浏览器缓存
2. 硬刷新页面（Ctrl + Shift + R）
3. 检查浏览器控制台是否有资源加载错误

---

## 部署成功标志

当以下所有条件满足时，部署成功：

- [x] Vercel 部署状态显示 Ready ✅
- [x] 公网地址可以正常访问 ✅
- [x] /api/init-db 返回成功 ✅
- [x] 可以使用 admin/admin123 登录 ✅
- [x] 四个角色端口都可以访问 ✅
- [x] 员工管理、订单管理、财务管理功能正常 ✅
- [x] 员工可以远程访问公网地址 ✅

---

## 总结

恭喜你！你已经成功将本地开发的 PPT 制作店铺员工管理系统部署到公网！

**公网地址：** https://ppt-shop-manager.vercel.app

**后续工作：**
1. 修改默认管理员密码
2. 添加员工账号
3. 分享公网地址给员工
4. 定期备份数据库
5. 监控系统运行状态

**技术栈：**
- 前端：Next.js 16 + React 19 + Tailwind CSS 4
- 后端：Next.js API Routes
- 数据库：PostgreSQL (Supabase)
- ORM：Drizzle ORM
- 部署：Vercel（免费）

---

**祝你使用愉快！🎉**
